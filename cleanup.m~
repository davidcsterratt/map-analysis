function newtriangles = cleanup(triangles, positions,tolerance)
%Deletes triangles from a list that have an angle greater than tolerance.
%Tolerance is given in degrees.

num_triangle = size(triangles,1);
t = 1;
newtriangles = triangles;

for n=1:num_triangles
    vertices = triangles(n,:);
    side_lengths = dist(positions(vertices,:),positions(vertices,:)');
    AB = side_lengths(1,2);
    AC = side_lengths(1,3);
    BC = side_lengths(2,3);
    
    cosine(1) = (AB^2+AC^2 - BC(2,3)^2)/(2*AB*AC);
    cosine(2) = (side_lengths(1,2)^2+side_lengths(3,2)^2 - side_lengths(1,3)^2)/(2*side_lengths(1,2)*side_lengths(3,2));
    cosine(3) = (side_lengths(1,3)^2+side_lengths(2,3)^2 - side_lengths(1,2)^2)/(2*side_lengths(1,3)*side_lengths(2,3));
    angles = acosd(cosine(:));
    
    if max(angles) > tolerance
       newtriangles(t,:) = [];
       t= t+1;
    end

end